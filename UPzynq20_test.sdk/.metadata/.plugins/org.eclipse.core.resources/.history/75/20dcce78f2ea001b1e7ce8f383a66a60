/*
 * logical_functions.c
 *
 *  Created on: 22 июл. 2021 г.
 *      Author: stud
 */

#include "logical_functions.h"

#include "xparameters.h"
#include "xgpio.h"
#include "xplatform_info.h"
#include "xuartps.h"
//#include "xil_exception.h"
#include "xil_printf.h"
#include "project_parameters.h"
#include "test_functions.h"
#include "module_uart_RS485.h"
#include "module_uart_SET12.h"
#include "test_functions_PS_MIO.h"
#include "current_system_status.h"


int latch_start_PMU = 0;

int initialization_system_design_and_project(int system_design, int project_number){
	initialization_input_output(system_design, project_number);
	initialization_PSGPIO(system_design, project_number);

	initialization_UART_SET12(); 		// инициализируем UART
	initialization_UART_RS485(); 		// инициализируем UART-RS485
}

void initialization_initial_values(){
	read_current_value_PSGPIO();								// прочитать свой адрес
	set_setpoint_value_adc_table();								// записать уставки аналоговых сигналов в МАЗ

	get_current_value_adc_table();								// получить значения АЦП
	get_current_value_digital_input_table();					// получить текущие значения входов
	get_current_value_speed_sensor_table();
	set_current_value_digital_output_table();					// установить выходы
}

void loading_control_panel(int count){
	set_current_value_PSGPIO(15, 1);
	if (latch_start_PMU == 0) {
		if (count == 0) {
			set_array_current_status_int(87, 0);
			preparing_message_RS485(2, 16, 1, 100, 200);
			set_array_current_status_bool(544, 0);
			preparing_message_RS485(2, 15, 544, 1, 2);


		}
		else {

				if (count < 11) {
					set_array_current_status_bool(544, 0);
					preparing_message_RS485(2, 15, 544, 1, 2);
					set_array_current_status_int(87, count);
					preparing_message_RS485(2, 16, 1, 100, 200);
				} else {

				set_array_current_status_bool(544, 1);
				preparing_message_RS485(2, 15, 544, 1, 2);
				set_array_current_status_int(87, 0);
				preparing_message_RS485(2, 16, 1, 100, 200);

				latch_start_PMU = 1;
			}
		}
	}
}

void filling_in_the_system_status_data(){

	get_current_value_digital_input_table();
}


